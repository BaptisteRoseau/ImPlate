\hypertarget{main_8cpp}{}\section{src/main.cpp File Reference}
\label{main_8cpp}\index{src/main.\+cpp@{src/main.\+cpp}}
{\ttfamily \#include \char`\"{}utils.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}blur.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}options.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}gopt/gopt.\+h\char`\"{}}\newline
{\ttfamily \#include $<$opencv4/opencv2/opencv.\+hpp$>$}\newline
{\ttfamily \#include $<$opencv4/opencv2/core/mat.\+hpp$>$}\newline
{\ttfamily \#include $<$alpr.\+h$>$}\newline
{\ttfamily \#include $<$filesystem$>$}\newline
{\ttfamily \#include $<$sys/types.\+h$>$}\newline
{\ttfamily \#include $<$sys/stat.\+h$>$}\newline
{\ttfamily \#include $<$sys/io.\+h$>$}\newline
{\ttfamily \#include $<$cstdio$>$}\newline
{\ttfamily \#include $<$cstdlib$>$}\newline
{\ttfamily \#include $<$unistd.\+h$>$}\newline
{\ttfamily \#include $<$assert.\+h$>$}\newline
{\ttfamily \#include $<$iostream$>$}\newline
{\ttfamily \#include $<$fstream$>$}\newline
{\ttfamily \#include $<$cstring$>$}\newline
{\ttfamily \#include $<$stack$>$}\newline
{\ttfamily \#include $<$limits.\+h$>$}\newline
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{main_8cpp_a39912bfe2a55f30e269196f9141d845d}{B\+U\+F\+F\+S\+I\+ZE}~200
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \hyperlink{main_8cpp_a0c1a3c85a4e6cb3000703c8b8b8f0ba6}{plate\+\_\+corners} (const vector$<$ Alpr\+Plate\+Result $>$ \&results, vector$<$ vector$<$ Point $>$ $>$ \&\hyperlink{main__corner_8cpp_a09dc1a0b5c61500ad117bedf43340c0b}{corners}, vector$<$ string $>$ \&numbers)
\begin{DoxyCompactList}\small\item\em Stream to the file where the logs will be saved. \end{DoxyCompactList}\item 
int \hyperlink{main_8cpp_a116aeb6f029dd003a9a3e0fea37f7ec7}{process} (const char $\ast$in\+\_\+path, const char $\ast$out\+\_\+path, const char $\ast$output\+\_\+name\+\_\+addon, const double timeout, const unsigned int blur\+\_\+filter\+\_\+size, const bool respect\+\_\+input\+\_\+path, const char $\ast$log\+\_\+file, const char $\ast$country, const bool save\+\_\+plate\+\_\+info, const char $\ast$plate\+\_\+info\+\_\+save\+\_\+path, const bool blur\+\_\+only, const char $\ast$blur\+\_\+only\+\_\+location, const bool replace\+\_\+input\+\_\+file)
\begin{DoxyCompactList}\small\item\em Main process. \end{DoxyCompactList}\item 
void \hyperlink{main_8cpp_a1ad940455be56209415d328d78622715}{usage} (char $\ast$name)
\item 
int \hyperlink{main_8cpp_a3c04138a5bfe5d72780bb7e82a18e627}{main} (int argc, char $\ast$$\ast$argv)
\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
bool \hyperlink{main_8cpp_ab3f078684998b83967d507d0f453f454}{verbose}
\item 
bool \hyperlink{main_8cpp_abcc3fefbf1ee9c4ef290623d427df143}{save\+\_\+log}
\begin{DoxyCompactList}\small\item\em Whether or not information should be displayed. \end{DoxyCompactList}\item 
ofstream \hyperlink{main_8cpp_a80cfbd8d58b0a285b5a3c999c05b115b}{log\+\_\+ostream}
\begin{DoxyCompactList}\small\item\em Whether or not logs should be saved (default\+: false) \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Macro Definition Documentation}
\mbox{\Hypertarget{main_8cpp_a39912bfe2a55f30e269196f9141d845d}\label{main_8cpp_a39912bfe2a55f30e269196f9141d845d}} 
\index{main.\+cpp@{main.\+cpp}!B\+U\+F\+F\+S\+I\+ZE@{B\+U\+F\+F\+S\+I\+ZE}}
\index{B\+U\+F\+F\+S\+I\+ZE@{B\+U\+F\+F\+S\+I\+ZE}!main.\+cpp@{main.\+cpp}}
\subsubsection{\texorpdfstring{B\+U\+F\+F\+S\+I\+ZE}{BUFFSIZE}}
{\footnotesize\ttfamily \#define B\+U\+F\+F\+S\+I\+ZE~200}



\subsection{Function Documentation}
\mbox{\Hypertarget{main_8cpp_a3c04138a5bfe5d72780bb7e82a18e627}\label{main_8cpp_a3c04138a5bfe5d72780bb7e82a18e627}} 
\index{main.\+cpp@{main.\+cpp}!main@{main}}
\index{main@{main}!main.\+cpp@{main.\+cpp}}
\subsubsection{\texorpdfstring{main()}{main()}}
{\footnotesize\ttfamily int main (\begin{DoxyParamCaption}\item[{int}]{argc,  }\item[{char $\ast$$\ast$}]{argv }\end{DoxyParamCaption})}


\begin{DoxyCode}
329                                \{
330     \textcolor{keywordflow}{if} (argc == 1)\{
331         \hyperlink{main_8cpp_a1ad940455be56209415d328d78622715}{usage}(argv[0]);
332         \textcolor{keywordflow}{return} -1;
333     \}
334 
335     \textcolor{comment}{// Global variable initialization}
336     \hyperlink{main_8cpp_abcc3fefbf1ee9c4ef290623d427df143}{save\_log} = \textcolor{keyword}{false};
337     \hyperlink{main_8cpp_ab3f078684998b83967d507d0f453f454}{verbose}  = \textcolor{keyword}{false};
338 
339     \textcolor{comment}{// Argument declaration and defaul value}
340     \textcolor{keywordtype}{char}* in\_path = \textcolor{keyword}{new} \textcolor{keywordtype}{char}[\hyperlink{main_8cpp_a39912bfe2a55f30e269196f9141d845d}{BUFFSIZE}];
341     \textcolor{keywordtype}{char}* out\_path = \textcolor{keyword}{new} \textcolor{keywordtype}{char}[\hyperlink{main_8cpp_a39912bfe2a55f30e269196f9141d845d}{BUFFSIZE}];
342     \textcolor{keywordtype}{char} *output\_name\_addon = \textcolor{keyword}{new} \textcolor{keywordtype}{char}[\hyperlink{main_8cpp_a39912bfe2a55f30e269196f9141d845d}{BUFFSIZE}];
343     strcpy(output\_name\_addon, \hyperlink{main__corner_8cpp_a64c20f761398137e8c54f7db39b1f6e8}{DFLT\_OUTPUT\_ADDON});
344     \textcolor{keywordtype}{double} timeout = 0;
345     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} blur\_filter\_size = \hyperlink{main__corner_8cpp_a4ea69b139dec27f3e30bac70e4002c2d}{DFLT\_BLUR};
346     \textcolor{keywordtype}{bool} respect\_input\_path = \textcolor{keyword}{false};
347     \textcolor{keywordtype}{char} *log\_file = \textcolor{keyword}{new} \textcolor{keywordtype}{char}[\hyperlink{main_8cpp_a39912bfe2a55f30e269196f9141d845d}{BUFFSIZE}];
348     \textcolor{keywordtype}{char} *country = \textcolor{keyword}{new} \textcolor{keywordtype}{char}[\hyperlink{main_8cpp_a39912bfe2a55f30e269196f9141d845d}{BUFFSIZE}];
349     strcpy(country, \hyperlink{options_8h_a6423a8fe8797e552531c808829ea150c}{DFLT\_COUNTRY});
350     \textcolor{keywordtype}{bool} save\_plate\_info = \textcolor{keyword}{false};
351     \textcolor{keywordtype}{char} *plate\_info\_save\_path = NULL; \textcolor{comment}{// Dynamically allocated if argument provided}
352     \textcolor{keywordtype}{bool} blur\_only = \textcolor{keyword}{false};
353     \textcolor{keywordtype}{char} *blur\_only\_location = \textcolor{keyword}{new} \textcolor{keywordtype}{char}[\hyperlink{main_8cpp_a39912bfe2a55f30e269196f9141d845d}{BUFFSIZE}];
354     \textcolor{keywordtype}{bool} replace\_input\_file = \textcolor{keyword}{false};
355 
356     \textcolor{comment}{// Parsing command line}
357     \hyperlink{options_8cpp_a32e3d254407b832defbb31e1f5c16dbd}{parse\_argv}(argv, in\_path, out\_path,
358                output\_name\_addon,
359                timeout,
360                blur\_filter\_size,
361                \hyperlink{main_8cpp_ab3f078684998b83967d507d0f453f454}{verbose},
362                respect\_input\_path,
363                \hyperlink{main_8cpp_abcc3fefbf1ee9c4ef290623d427df143}{save\_log},
364                log\_file,
365                country,
366                save\_plate\_info,
367                plate\_info\_save\_path,
368                blur\_only,
369                blur\_only\_location,
370                replace\_input\_file);
371 
372     \textcolor{comment}{// Executing main process}
373     \textcolor{keywordtype}{int} ret = \hyperlink{main_8cpp_a116aeb6f029dd003a9a3e0fea37f7ec7}{process}(in\_path, out\_path,
374                       output\_name\_addon,
375                       timeout,
376                       blur\_filter\_size,
377                       respect\_input\_path,
378                       log\_file,
379                       country,
380                       save\_plate\_info,
381                       plate\_info\_save\_path,
382                       blur\_only,
383                       blur\_only\_location,
384                       replace\_input\_file);
385 
386     \textcolor{keyword}{delete}[] in\_path;
387     \textcolor{keyword}{delete}[] out\_path;
388     \textcolor{keyword}{delete}[] log\_file;
389     \textcolor{keyword}{delete}[] output\_name\_addon;
390     \textcolor{keyword}{delete}[] country;
391     \textcolor{keyword}{delete}[] blur\_only\_location;
392     \textcolor{keywordflow}{if} (plate\_info\_save\_path != NULL) \textcolor{keyword}{delete}[] plate\_info\_save\_path;
393 
394     \textcolor{keywordflow}{return} ret;
395 \}
\end{DoxyCode}
\mbox{\Hypertarget{main_8cpp_a0c1a3c85a4e6cb3000703c8b8b8f0ba6}\label{main_8cpp_a0c1a3c85a4e6cb3000703c8b8b8f0ba6}} 
\index{main.\+cpp@{main.\+cpp}!plate\+\_\+corners@{plate\+\_\+corners}}
\index{plate\+\_\+corners@{plate\+\_\+corners}!main.\+cpp@{main.\+cpp}}
\subsubsection{\texorpdfstring{plate\+\_\+corners()}{plate\_corners()}}
{\footnotesize\ttfamily void plate\+\_\+corners (\begin{DoxyParamCaption}\item[{const vector$<$ Alpr\+Plate\+Result $>$ \&}]{results,  }\item[{vector$<$ vector$<$ Point $>$ $>$ \&}]{corners,  }\item[{vector$<$ string $>$ \&}]{numbers }\end{DoxyParamCaption})}



Stream to the file where the logs will be saved. 

Retireves the plates corners and number from results to corners and numbers


\begin{DoxyParams}{Parameters}
{\em results} & the returned value of the alpr process \\
\hline
{\em corners} & a buffer where to write corners (from top-\/left following the chonological order) \\
\hline
{\em numbers} & a buffer where to write the detected plates \\
\hline
\end{DoxyParams}

\begin{DoxyCode}
46                                          \{
47     \textcolor{keywordtype}{size\_t} i, j;
48     vector<Point> tmp\_vect;
49     Point tmp\_pt;
50     \textcolor{keywordflow}{for} (i = 0; i < results.size(); i++)\{
51         \textcolor{keywordflow}{for} (j = 0; j < 4; j++)\{
52             tmp\_pt.x = results[i].plate\_points[j].x;
53             tmp\_pt.y = results[i].plate\_points[j].y;
54             tmp\_vect.push\_back(tmp\_pt);
55         \}
56         \hyperlink{main__corner_8cpp_a09dc1a0b5c61500ad117bedf43340c0b}{corners}.push\_back(tmp\_vect); 
57         numbers.push\_back(results[i].bestPlate.characters);
58         tmp\_vect.clear();
59     \}
60 \}
\end{DoxyCode}
\mbox{\Hypertarget{main_8cpp_a116aeb6f029dd003a9a3e0fea37f7ec7}\label{main_8cpp_a116aeb6f029dd003a9a3e0fea37f7ec7}} 
\index{main.\+cpp@{main.\+cpp}!process@{process}}
\index{process@{process}!main.\+cpp@{main.\+cpp}}
\subsubsection{\texorpdfstring{process()}{process()}}
{\footnotesize\ttfamily int process (\begin{DoxyParamCaption}\item[{const char $\ast$}]{in\+\_\+path,  }\item[{const char $\ast$}]{out\+\_\+path,  }\item[{const char $\ast$}]{output\+\_\+name\+\_\+addon,  }\item[{const double}]{timeout,  }\item[{const unsigned int}]{blur\+\_\+filter\+\_\+size,  }\item[{const bool}]{respect\+\_\+input\+\_\+path,  }\item[{const char $\ast$}]{log\+\_\+file,  }\item[{const char $\ast$}]{country,  }\item[{const bool}]{save\+\_\+plate\+\_\+info,  }\item[{const char $\ast$}]{plate\+\_\+info\+\_\+save\+\_\+path,  }\item[{const bool}]{blur\+\_\+only,  }\item[{const char $\ast$}]{blur\+\_\+only\+\_\+location,  }\item[{const bool}]{replace\+\_\+input\+\_\+file }\end{DoxyParamCaption})}



Main process. 


\begin{DoxyParams}{Parameters}
{\em in\+\_\+path} & the path to the inpu directory or picture file \\
\hline
{\em out\+\_\+path} & the path to the output file if input is a file, output directory else \\
\hline
{\em output\+\_\+name\+\_\+addon} & the characters added before the extensions on rendered images \\
\hline
{\em timeout} & a timeout in seconds \\
\hline
{\em blur\+\_\+filter\+\_\+size} & the size of the square area used to make the blur effect \\
\hline
{\em log\+\_\+file} & the path to the file containing all the logs (displayed text) for a given runtime \\
\hline
{\em country} & the country code for the plate detection \\
\hline
{\em save\+\_\+plate\+\_\+info} & whether or not alpr\textquotesingle{}s plate recognition have to be saved (in json format). \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
int 0 for success, 1 else 
\end{DoxyReturn}
Detected plates \+: \mbox{[}plate1\+: \mbox{[}tl, tr, br, bl\mbox{]}, plate2\+: ...\mbox{]} 
\begin{DoxyCode}
87                                           \{
88 
89     \textcolor{comment}{// Retrieving picture file paths into stack\_files}
90     stack<string> *stack\_files = \hyperlink{utils_8cpp_ae4643e188dffcf0be61ad466be616893}{list\_files}(in\_path);
91     \textcolor{keywordflow}{if} (stack\_files == NULL)\{
92         \textcolor{comment}{//Don't use DISPLAY\_ERR }
93         \textcolor{comment}{// you want to see this message even without verbose}
94         cerr << \textcolor{stringliteral}{"\(\backslash\)033[1;31mERROR:\(\backslash\)033[0m Couldn't open any file.\(\backslash\)n"};
95         exit(EXIT\_FAILURE);
96     \}
97 
98     \textcolor{comment}{// Opening log file if necessary}
99     \textcolor{keywordflow}{if} (\hyperlink{main_8cpp_abcc3fefbf1ee9c4ef290623d427df143}{save\_log})\{
100         \hyperlink{main_8cpp_a80cfbd8d58b0a285b5a3c999c05b115b}{log\_ostream}.open(log\_file);
101         \textcolor{keywordflow}{if} (!\hyperlink{main_8cpp_a80cfbd8d58b0a285b5a3c999c05b115b}{log\_ostream})\{
102             cerr << \textcolor{stringliteral}{"\(\backslash\)033[1;31mERROR:\(\backslash\)033[0m Couldn't open "} << log\_file << endl;
103             exit(EXIT\_FAILURE);
104         \}
105     \}
106 
107     \textcolor{comment}{// Building output directory if it doesn't exists, and if input is a directory}
108     \textcolor{keywordflow}{if} (!fs::directory\_entry(in\_path).is\_regular\_file())\{
109         \textcolor{keywordflow}{if} (!\hyperlink{utils_8cpp_ab20f60b1e5e97d647adbb5accca11b31}{build\_dir}(out\_path))\{
110             cerr << \textcolor{stringliteral}{"\(\backslash\)033[1;31mERROR:\(\backslash\)033[0m Couldn't build output directory.\(\backslash\)n"};
111             exit(EXIT\_FAILURE);
112         \}
113     \}
114 
115     \textcolor{comment}{// Parameters initialisation}
116     stack<string> failed\_pictures = stack<string>();
117     Mat picture = Mat();
118     Mat blured  = Mat();
119     \textcolor{keywordtype}{string} filepath, filename, fileext, savedir;
120     \textcolor{keywordtype}{int} error;
121     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} loop\_idx = 0;
122     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} nb\_files = stack\_files->size();
123     \textcolor{keywordtype}{double} \_timeout = timeout == 0 ? DBL\_MAX : timeout; 
124     \textcolor{keywordtype}{double} t0 = time(NULL);
125     \textcolor{keyword}{const} \textcolor{keywordtype}{size\_t} nb\_pictures = stack\_files->size(); \textcolor{comment}{//For success rate}
126     \textcolor{comment}{//const vector country\_code\_vect = \{"eu", "fr", "gb", "us", "au", "br", "in"\};}
127 
128     \textcolor{comment}{// Blur only input verification}
129     \textcolor{keywordflow}{if} (blur\_only)\{
130         \textcolor{keywordflow}{if} (stack\_files->size() != 1 || !fs::directory\_entry(in\_path).is\_regular\_file())\{
131             cerr << \textcolor{stringliteral}{"\(\backslash\)033[1;31mERROR:\(\backslash\)033[0m Only 1 file can be given for blur only.\(\backslash\)n"};
132             exit(EXIT\_FAILURE);
133         \}
134     \}
135 
136     \textcolor{comment}{// Main loop}
137     \textcolor{keywordflow}{while} (!stack\_files->empty())\{
138         \textcolor{comment}{// Getting file path informations}
139         filepath = \hyperlink{utils_8cpp_ae5b1ab76259e06682dd39bec35eabae7}{stack\_next}(stack\_files);
140         filename = \hyperlink{utils_8cpp_a4ea7fd2a97d2581efbe44b7093f546e1}{get\_filename}(filepath);
141         fileext  = \hyperlink{utils_8cpp_aab7a8df6fb5d890b89762e315e34b6c5}{get\_file\_extension}(filepath);
142         loop\_idx++;
143 
144         \textcolor{comment}{// Displaying script advancement}
145         \hyperlink{utils_8h_a6281452b8be5febd0a1ba61a4b867ab5}{DISPLAY}(\textcolor{stringliteral}{"\(\backslash\)nPicture: "} << loop\_idx << \textcolor{stringliteral}{" out of "} << nb\_files
146              << \textcolor{stringliteral}{" ("} << (\textcolor{keywordtype}{float}) 100*loop\_idx/nb\_files << \textcolor{stringliteral}{" %) : "} << filename)
147 
148         \textcolor{comment}{// Opening picture}
149         picture = \hyperlink{utils_8cpp_aa6d4b502c0c32edc596e2b0f7f1a3aa5}{open\_picture}(filepath);
150         \textcolor{keywordflow}{if} (picture.empty())\{
151             \hyperlink{utils_8h_ad5cf6896472401b4d1f4250c8ef96e7c}{DISPLAY\_ERR}(\textcolor{stringliteral}{"Couldn't open "} << filepath);
152             failed\_pictures.push(filepath);
153             \textcolor{keywordflow}{continue};
154         \}
155 
156         \textcolor{comment}{/* ==== PLATE DETECTION AND BLUR BEGIN ==== */}
157 
158         \textcolor{comment}{// Buffers to get ALPR results}
159         vector<vector<Point> > \hyperlink{main__corner_8cpp_a09dc1a0b5c61500ad117bedf43340c0b}{corners} = vector<vector<Point> >(); 
160         vector<string> numbers = vector<string>();;
161         Alpr detector = Alpr(country, \hyperlink{options_8h_a518656120c6dc6698ef7e675f55f1c43}{DFLT\_CONFIG\_FILE}, 
      \hyperlink{options_8h_aa02efea6d774e00176e31b31e757a889}{DFLT\_RUNTIME\_DIR});
162         AlprResults alpr\_results;
163 
164         \textcolor{keywordflow}{if} (!blur\_only)\{
165             \textcolor{comment}{// Getting picture's plate informations}
166             alpr\_results = detector.recognize(filepath);
167             vector<AlprPlateResult> results = alpr\_results.plates;
168             \hyperlink{main_8cpp_a0c1a3c85a4e6cb3000703c8b8b8f0ba6}{plate\_corners}(results, corners, numbers);
169             \textcolor{keywordflow}{if} (corners.size() == 0)\{
170                 \hyperlink{utils_8h_ad5cf6896472401b4d1f4250c8ef96e7c}{DISPLAY\_ERR}(\textcolor{stringliteral}{"No plate detected on "} << filename);
171                 failed\_pictures.push(filepath);
172                 \textcolor{keywordflow}{continue};
173             \}
174             
175             \textcolor{comment}{// Displaying the plates numbers}
176             \textcolor{keywordflow}{if} (\hyperlink{main_8cpp_ab3f078684998b83967d507d0f453f454}{verbose} || \hyperlink{main_8cpp_abcc3fefbf1ee9c4ef290623d427df143}{save\_log})\{
177                 \hyperlink{utils_8h_a6281452b8be5febd0a1ba61a4b867ab5}{DISPLAY}(\textcolor{stringliteral}{"Plates detected:"})
178                 for (auto&& num: numbers)\{
179                     \hyperlink{utils_8h_a6281452b8be5febd0a1ba61a4b867ab5}{DISPLAY}(num);
180                 \}
181             \}
182         \} \textcolor{keywordflow}{else} \{
183             \textcolor{comment}{// Parsing corners and verifying validity}
184             corners = \hyperlink{utils_8cpp_ac5cf585d84f32faf46bd54e736582c9a}{parse\_location}(blur\_only\_location);
185             \textcolor{keywordflow}{for} (\textcolor{keyword}{auto}&& cor: corners)\{
186                 \textcolor{keywordflow}{for} (\textcolor{keyword}{auto}&& pt: cor)\{
187                     \textcolor{keywordflow}{if} (pt.x < 0 || pt.y < 0 || pt.x > picture.cols || pt.y > picture.rows)\{
188                         cerr << \textcolor{stringliteral}{"\(\backslash\)033[1;31mERROR:\(\backslash\)033[0m Invalid pixel location: "} << blur\_only\_location
189                         << \textcolor{stringliteral}{"\(\backslash\)nPlease respect format x11\_y11\_x12\_y12\_x13\_y13\_x14\_y14\_x21\_y21.. with valid
       values."} << endl;
190                         exit(EXIT\_FAILURE);
191                     \}
192                 \}
193                 \hyperlink{utils_8cpp_a1019114e31070a917af7b19bab80052c}{sort\_corners}(cor); \textcolor{comment}{//NOT IMPLEMENTED}
194             \}
195         \}
196 
197         \textcolor{comment}{// Bluring a copy of the initial picture}
198         blured = picture.clone();
199         error = 0;
200         \textcolor{keywordflow}{for} (\textcolor{keyword}{auto}&& corn: corners)\{
201             error += \hyperlink{utils_8h_a7742fa23cad0b81a56daae0c5ad63c8b}{\_max}(\hyperlink{blur_8cpp_a5a840e0bd20fadca13ad48a56f32db33}{blur}(picture, blured, corn, blur\_filter\_size), error);
202         \}
203         \textcolor{keywordflow}{if} (error)\{
204             \hyperlink{utils_8h_ad5cf6896472401b4d1f4250c8ef96e7c}{DISPLAY\_ERR}(\textcolor{stringliteral}{"Couldn't blur"} << error << \textcolor{stringliteral}{" times out of "} << corners.size() << \textcolor{stringliteral}{" on "}
       << filename);
205             \textcolor{comment}{//if ((unsigned int) error == corners.size())\{ //Skip only if every blur failed}
206                 failed\_pictures.push(filepath);
207                 \textcolor{keywordflow}{continue};
208             \textcolor{comment}{//\}}
209         \}
210 
211         \textcolor{comment}{/* ==== PLATE DETECTION AND BLUR END ==== */}
212 
213         \textcolor{comment}{//TODO: Factorize "replace\_input\_file" option}
214         \textcolor{comment}{// If input is a file, output will be directly out\_path, not a directory}
215         \textcolor{keywordflow}{if} (fs::directory\_entry(in\_path).is\_regular\_file())\{
216             \textcolor{keywordflow}{if} (\hyperlink{utils_8cpp_a8dab6a9def9013ef3bdfa6a9991c2e4d}{build\_directories}(out\_path))\{
217                 \textcolor{keywordflow}{if} (fs::path(out\_path).has\_extension())\{
218                     \textcolor{keywordflow}{if} (replace\_input\_file)\{
219                         \textcolor{comment}{// Replacing input file if "--rename" option}
220                         fs::rename(filepath, out\_path);
221                         savedir = (string) fs::path(out\_path).parent\_path(); \textcolor{comment}{//Used for save-info}
222                         \hyperlink{utils_8cpp_a055f358e0b6695779f8b5125bfb9f6e8}{save\_picture}(blured, filepath);
223                     \} \textcolor{keywordflow}{else} \{
224                         \textcolor{comment}{// Saving file as in given}
225                         savedir = (string) fs::path(out\_path).parent\_path();
226                         \hyperlink{utils_8cpp_a055f358e0b6695779f8b5125bfb9f6e8}{save\_picture}(blured, out\_path);
227                     \}
228                 \} \textcolor{keywordflow}{else} \{
229                     \textcolor{keywordflow}{if} (replace\_input\_file)\{
230                         \textcolor{comment}{// Replacing input file if "--rename" option}
231                         fs::rename(filepath, (\textcolor{keywordtype}{string})out\_path+\textcolor{stringliteral}{"/"}+filename+output\_name\_addon+fileext);
232                         savedir = (string) out\_path; \textcolor{comment}{//Used for save-info}
233                         \hyperlink{utils_8cpp_a055f358e0b6695779f8b5125bfb9f6e8}{save\_picture}(blured, filepath);
234                     \} \textcolor{keywordflow}{else} \{
235                         \textcolor{comment}{// Saving file into the directory given}
236                         savedir = out\_path;
237                         \hyperlink{utils_8cpp_a055f358e0b6695779f8b5125bfb9f6e8}{save\_picture}(blured, out\_path, filename+output\_name\_addon+fileext);
238                     \}
239                 \}
240             \} \textcolor{keywordflow}{else} \{
241                 \textcolor{keywordflow}{continue};
242             \}
243         \textcolor{comment}{// If input is a directory, }
244         \} \textcolor{keywordflow}{else} \{
245             \textcolor{comment}{// Selecting output directory and building requiered directories}
246             savedir = \hyperlink{utils_8cpp_acb8dcd394d479af8e54fa59e13367361}{select\_output\_dir}(out\_path, in\_path, filepath, respect\_input\_path);
247             \textcolor{keywordflow}{if} (!\hyperlink{utils_8cpp_a8dab6a9def9013ef3bdfa6a9991c2e4d}{build\_directories}(savedir))\{
248                 \textcolor{keywordflow}{continue};
249             \}
250             \textcolor{keywordflow}{if} (replace\_input\_file)\{
251                 \textcolor{comment}{// Replacing input file}
252                 fs::rename(filepath, savedir+\textcolor{stringliteral}{"/"}+filename+output\_name\_addon+fileext);
253                 \hyperlink{utils_8cpp_a055f358e0b6695779f8b5125bfb9f6e8}{save\_picture}(blured, filepath);
254             \} \textcolor{keywordflow}{else} \{
255                 \textcolor{comment}{// Writing blured picture into the directory}
256                 \hyperlink{utils_8cpp_a055f358e0b6695779f8b5125bfb9f6e8}{save\_picture}(blured, savedir, filename+output\_name\_addon+fileext);
257             \}
258         \}
259 
260         \textcolor{comment}{// Saving the plate information if necessary}
261         \textcolor{keywordflow}{if} (!blur\_only && save\_plate\_info && !numbers.empty())\{
262             \textcolor{keywordtype}{string} plate\_file = savedir+\textcolor{stringliteral}{"/"}+filename+\hyperlink{options_8h_aedbea03e3cf8c526aaf157c85a0d7ce3}{DFLT\_JSON\_ADDON}+\textcolor{stringliteral}{".json"};
263             \textcolor{comment}{// If -s option has a path given, behavior is the same as above}
264             \textcolor{keywordflow}{if} (fs::directory\_entry(in\_path).is\_regular\_file() && plate\_info\_save\_path != NULL)\{
265                 \textcolor{keywordflow}{if} (\hyperlink{utils_8cpp_a8dab6a9def9013ef3bdfa6a9991c2e4d}{build\_directories}(plate\_info\_save\_path))\{
266                     \textcolor{keywordflow}{if} (fs::path(plate\_info\_save\_path).has\_extension())\{
267                         plate\_file = plate\_info\_save\_path;
268                     \} \textcolor{keywordflow}{else} \{
269                         plate\_file = ((string) plate\_info\_save\_path)+\textcolor{stringliteral}{"/"}+filename+DFLT\_JSON\_ADDON+\textcolor{stringliteral}{".json"};
270                     \}
271                 \}
272             \}
273             ofstream plate\_ostream;
274             plate\_ostream.open(plate\_file);
275             \textcolor{keywordflow}{if} (!plate\_ostream)\{
276                 \hyperlink{utils_8h_ad5cf6896472401b4d1f4250c8ef96e7c}{DISPLAY\_ERR}(\textcolor{stringliteral}{"Couldn't open "} << plate\_file);
277             \} \textcolor{keywordflow}{else} \{
278                 plate\_ostream << detector.toJson(alpr\_results);
279                 \hyperlink{utils_8h_a6281452b8be5febd0a1ba61a4b867ab5}{DISPLAY}(\textcolor{stringliteral}{"Wrote plate info "} << plate\_file)
280             \}
281             plate\_ostream.close();
282         \}
283         
284         \textcolor{comment}{// Cleaning memory and exiting program if \_timeout is reached}
285         \textcolor{keywordflow}{if} (difftime(time(NULL), t0) > \_timeout)\{           
286             \textcolor{keyword}{delete} stack\_files;
287             \hyperlink{utils_8h_a6281452b8be5febd0a1ba61a4b867ab5}{DISPLAY}(\textcolor{stringliteral}{"Timeout reached."});
288             \textcolor{keywordflow}{return} EXIT\_SUCCESS;
289         \}
290         
291     \}
292 
293     \textcolor{keyword}{const} \textcolor{keywordtype}{size\_t} nb\_failed = failed\_pictures.size(); \textcolor{comment}{// For success rate}
294     \textcolor{keywordflow}{if} ((\hyperlink{main_8cpp_ab3f078684998b83967d507d0f453f454}{verbose} || \hyperlink{main_8cpp_abcc3fefbf1ee9c4ef290623d427df143}{save\_log}) && !failed\_pictures.empty())\{
295         \hyperlink{utils_8h_a6281452b8be5febd0a1ba61a4b867ab5}{DISPLAY}(\textcolor{stringliteral}{"\(\backslash\)nSome pictures plate analysis or blur failed:"})
296 
297         \textcolor{comment}{// Opening file containing failed pictures only}
298         ofstream failedpic\_stream;
299         failedpic\_stream.open(\hyperlink{options_8h_a39564f8719739177c8dba39b9b1c7f72}{DFLT\_FAILED\_PIC\_DIR});
300         if (!failedpic\_stream)\{
301             \hyperlink{utils_8h_ad5cf6896472401b4d1f4250c8ef96e7c}{DISPLAY\_ERR}(\textcolor{stringliteral}{"Couldn't open "} << DFLT\_FAILED\_PIC\_DIR)
302         \}
303 
304         \textcolor{comment}{// Displaying and writing failed pictures path}
305         \textcolor{keywordflow}{while} (!failed\_pictures.empty())
306         \{
307             \hyperlink{utils_8h_a6281452b8be5febd0a1ba61a4b867ab5}{DISPLAY}(failed\_pictures.top());
308             failedpic\_stream << failed\_pictures.top() << endl;
309             failed\_pictures.pop();
310         \}
311     \}
312 
313     \hyperlink{utils_8h_a6281452b8be5febd0a1ba61a4b867ab5}{DISPLAY}(\textcolor{stringliteral}{"\(\backslash\)nExited successfully ("} << difftime(time(NULL), t0) << \textcolor{stringliteral}{" seconds). "}
314     << \textcolor{stringliteral}{"Success rate: "} << 100*((\textcolor{keywordtype}{double}) (nb\_pictures - nb\_failed)/(\textcolor{keywordtype}{double}) nb\_pictures) << \textcolor{stringliteral}{" %"});
315 
316     \textcolor{comment}{// Cleaning memory}
317     \textcolor{keyword}{delete} stack\_files;
318 
319     \textcolor{keywordflow}{return} EXIT\_SUCCESS;
320 \}
\end{DoxyCode}
\mbox{\Hypertarget{main_8cpp_a1ad940455be56209415d328d78622715}\label{main_8cpp_a1ad940455be56209415d328d78622715}} 
\index{main.\+cpp@{main.\+cpp}!usage@{usage}}
\index{usage@{usage}!main.\+cpp@{main.\+cpp}}
\subsubsection{\texorpdfstring{usage()}{usage()}}
{\footnotesize\ttfamily void usage (\begin{DoxyParamCaption}\item[{char $\ast$}]{name }\end{DoxyParamCaption})}


\begin{DoxyCode}
322                       \{
323     cout <<\textcolor{stringliteral}{"\(\backslash\)}
324 \textcolor{stringliteral}{Usage: "} << name << \textcolor{stringliteral}{" -i <path to picture or directory>\(\backslash\)}
325 \textcolor{stringliteral}{-o <output directory>\(\backslash\)n\(\backslash\)}
326 \textcolor{stringliteral}{Type -h or --help for more details.\(\backslash\)n"};
327 \}
\end{DoxyCode}


\subsection{Variable Documentation}
\mbox{\Hypertarget{main_8cpp_a80cfbd8d58b0a285b5a3c999c05b115b}\label{main_8cpp_a80cfbd8d58b0a285b5a3c999c05b115b}} 
\index{main.\+cpp@{main.\+cpp}!log\+\_\+ostream@{log\+\_\+ostream}}
\index{log\+\_\+ostream@{log\+\_\+ostream}!main.\+cpp@{main.\+cpp}}
\subsubsection{\texorpdfstring{log\+\_\+ostream}{log\_ostream}}
{\footnotesize\ttfamily ofstream log\+\_\+ostream}



Whether or not logs should be saved (default\+: false) 

\mbox{\Hypertarget{main_8cpp_abcc3fefbf1ee9c4ef290623d427df143}\label{main_8cpp_abcc3fefbf1ee9c4ef290623d427df143}} 
\index{main.\+cpp@{main.\+cpp}!save\+\_\+log@{save\+\_\+log}}
\index{save\+\_\+log@{save\+\_\+log}!main.\+cpp@{main.\+cpp}}
\subsubsection{\texorpdfstring{save\+\_\+log}{save\_log}}
{\footnotesize\ttfamily bool save\+\_\+log}



Whether or not information should be displayed. 

\mbox{\Hypertarget{main_8cpp_ab3f078684998b83967d507d0f453f454}\label{main_8cpp_ab3f078684998b83967d507d0f453f454}} 
\index{main.\+cpp@{main.\+cpp}!verbose@{verbose}}
\index{verbose@{verbose}!main.\+cpp@{main.\+cpp}}
\subsubsection{\texorpdfstring{verbose}{verbose}}
{\footnotesize\ttfamily bool verbose}

